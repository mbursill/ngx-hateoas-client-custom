/* tslint:disable:no-string-literal */
import { ResourceUtils } from '../util/resource.utils';
import { isArray, isEmpty, isNull, isUndefined } from 'lodash-es';
import { Resource } from './resource/resource';
import { EmbeddedResource } from './resource/embedded-resource';
/**
 * Decorator used to classes that extend {@link Resource} class to register 'resourceName' and 'resourceType'
 * information about this resource.
 *
 * @param resourceName resource name which will be used to build a resource URL.
 */
export function HateoasResource(resourceName) {
    return (constructor) => {
        if (isNull(resourceName) || isUndefined(resourceName) || !resourceName) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasResource decorator param resourceName can not be null/undefined/empty, please pass a valid resourceName.`);
        }
        if (!isInstanceOfParent(constructor, Resource)) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasResource decorator applied only to 'Resource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        constructor['__resourceName__'] = resourceName;
        ResourceUtils.RESOURCE_NAME_TYPE_MAP.set(resourceName.toLowerCase(), constructor);
        return constructor;
    };
}
/**
 * Decorator used to classes that extend {@link EmbeddedResource} class to register 'relationNames' and 'resourceType'
 * information about this resource.
 *
 * @param relationNames names of the properties that using to hold this embedded resource in resource objects.
 */
export function HateoasEmbeddedResource(relationNames) {
    return (constructor) => {
        if (isNull(relationNames)
            || isUndefined(relationNames)
            || (isArray(relationNames) && isEmpty(relationNames))) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasEmbeddedResource decorator param relationNames can not be null/undefined/empty, please pass a valid relationNames.`);
        }
        if (!isInstanceOfParent(constructor, EmbeddedResource)) {
            throw new Error(`Init resource '${constructor.name}' error. @HateoasEmbeddedResource decorator applied only to 'EmbeddedResource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        relationNames.forEach(relationName => {
            ResourceUtils.EMBEDDED_RESOURCE_TYPE_MAP.set(relationName, constructor);
        });
    };
}
/**
 * Decorator used to create a projection representation of {@link Resource} heirs.
 *
 * @param resourceType type of resource that using for projection.
 * @param projectionName name of projection, will be used as projection request param.
 */
export function HateoasProjection(resourceType, projectionName) {
    return (constructor) => {
        if (isNull(resourceType) || isUndefined(resourceType)) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator param resourceType can not be null/undefined, please pass a valid resourceType.`);
        }
        if (isNull(projectionName) || isUndefined(projectionName) || !projectionName) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator param projectionName can not be null/undefined/empty, please pass a valid projectionName.`);
        }
        if (!isInstanceOfParent(constructor, Resource)) {
            throw new Error(`Init resource projection '${constructor.name}' error. @HateoasProjection decorator applied only to 'Resource' type, you used it with ${Object.getPrototypeOf(constructor)} type.`);
        }
        constructor['__resourceName__'] = resourceType['__resourceName__'];
        constructor['__projectionName__'] = projectionName;
        ResourceUtils.RESOURCE_NAME_PROJECTION_TYPE_MAP.set(resourceType['__resourceName__'].toLowerCase(), constructor);
        return constructor;
    };
}
/**
 * Decorator used to mark projection class properties that are resources and specifying class type used to create this relation.
 * This decorator used with class marked as {@link HateoasProjection}.
 *
 * @param relationType resource relation type that will be used to create resource with this type when parsed server response.
 */
export function ProjectionRel(relationType) {
    return (target, propertyKey) => {
        if (isNull(relationType) || isUndefined(relationType)) {
            throw new Error(`Init resource projection '${target.constructor.name}' relation type error. @ProjectionRel decorator param relationType can not be null/undefined, please pass a valid relationType.`);
        }
        ResourceUtils.RESOURCE_PROJECTION_REL_NAME_TYPE_MAP.set(propertyKey, relationType);
    };
}
function isInstanceOfParent(constructor, parentClass) {
    if (Object.getPrototypeOf(constructor).name === '') {
        return false;
    }
    if (Object.getPrototypeOf(constructor) === parentClass) {
        return true;
    }
    return isInstanceOfParent(Object.getPrototypeOf(constructor), parentClass);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1oYXRlb2FzLWNsaWVudC9zcmMvbGliL21vZGVsL2RlY29yYXRvcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBQ3RDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN2RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUdoRTs7Ozs7R0FLRztBQUNILE1BQU0sVUFBVSxlQUFlLENBQUMsWUFBb0I7SUFDbEQsT0FBTyxDQUF1QyxXQUFjLEVBQUUsRUFBRTtRQUM5RCxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxXQUFXLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDdEUsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBbUIsV0FBVyxDQUFDLElBQUssMkhBQTJILENBQUMsQ0FBQztTQUNsTDtRQUVELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLEVBQUU7WUFDOUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBbUIsV0FBVyxDQUFDLElBQUsseUZBQTBGLE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQzVMO1FBQ0QsV0FBVyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsWUFBWSxDQUFDO1FBQy9DLGFBQWEsQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBRWxGLE9BQU8sV0FBVyxDQUFDO0lB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Q2xELE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFDRCxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEtBQUssV0FBVyxFQUFFO1FBQ3RELE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRCxPQUFPLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDN0UsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIHRzbGludDpkaXNhYmxlOm5vLXN0cmluZy1saXRlcmFsICovXHJcbmltcG9ydCB7IFJlc291cmNlVXRpbHMgfSBmcm9tICcuLi91dGlsL3Jlc291cmNlLnV0aWxzJztcclxuaW1wb3J0IHsgaXNBcnJheSwgaXNFbXB0eSwgaXNOdWxsLCBpc1VuZGVmaW5lZCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IFJlc291cmNlIH0gZnJvbSAnLi9yZXNvdXJjZS9yZXNvdXJjZSc7XHJcbmltcG9ydCB7IEVtYmVkZGVkUmVzb3VyY2UgfSBmcm9tICcuL3Jlc291cmNlL2VtYmVkZGVkLXJlc291cmNlJztcclxuaW1wb3J0IHsgQmFzZVJlc291cmNlIH0gZnJvbSAnLi9yZXNvdXJjZS9iYXNlLXJlc291cmNlJztcclxuXHJcbi8qKlxyXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBjbGFzc2VzIHRoYXQgZXh0ZW5kIHtAbGluayBSZXNvdXJjZX0gY2xhc3MgdG8gcmVnaXN0ZXIgJ3Jlc291cmNlTmFtZScgYW5kICdyZXNvdXJjZVR5cGUnXHJcbiAqIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgcmVzb3VyY2UuXHJcbiAqXHJcbiAqIEBwYXJhbSByZXNvdXJjZU5hbWUgcmVzb3VyY2UgbmFtZSB3aGljaCB3aWxsIGJlIHVzZWQgdG8gYnVpbGQgYSByZXNvdXJjZSBVUkwuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gSGF0ZW9hc1Jlc291cmNlKHJlc291cmNlTmFtZTogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIDxUIGV4dGVuZHMgbmV3KC4uLmFyZ3M6IGFueVtdKSA9PiBhbnk+KGNvbnN0cnVjdG9yOiBUKSA9PiB7XHJcbiAgICBpZiAoaXNOdWxsKHJlc291cmNlTmFtZSkgfHwgaXNVbmRlZmluZWQocmVzb3VyY2VOYW1lKSB8fCAhcmVzb3VyY2VOYW1lKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSAnJHsgY29uc3RydWN0b3IubmFtZSB9JyBlcnJvci4gQEhhdGVvYXNSZXNvdXJjZSBkZWNvcmF0b3IgcGFyYW0gcmVzb3VyY2VOYW1lIGNhbiBub3QgYmUgbnVsbC91bmRlZmluZWQvZW1wdHksIHBsZWFzZSBwYXNzIGEgdmFsaWQgcmVzb3VyY2VOYW1lLmApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghaXNJbnN0YW5jZU9mUGFyZW50KGNvbnN0cnVjdG9yLCBSZXNvdXJjZSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc1Jlc291cmNlIGRlY29yYXRvciBhcHBsaWVkIG9ubHkgdG8gJ1Jlc291cmNlJyB0eXBlLCB5b3UgdXNlZCBpdCB3aXRoICR7IE9iamVjdC5nZXRQcm90b3R5cGVPZihjb25zdHJ1Y3RvcikgfSB0eXBlLmApO1xyXG4gICAgfVxyXG4gICAgY29uc3RydWN0b3JbJ19fcmVzb3VyY2VOYW1lX18nXSA9IHJlc291cmNlTmFtZTtcclxuICAgIFJlc291cmNlVXRpbHMuUkVTT1VSQ0VfTkFNRV9UWVBFX01BUC5zZXQocmVzb3VyY2VOYW1lLnRvTG93ZXJDYXNlKCksIGNvbnN0cnVjdG9yKTtcclxuXHJcbiAgICByZXR1cm4gY29uc3RydWN0b3I7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIERlY29yYXRvciB1c2VkIHRvIGNsYXNzZXMgdGhhdCBleHRlbmQge0BsaW5rIEVtYmVkZGVkUmVzb3VyY2V9IGNsYXNzIHRvIHJlZ2lzdGVyICdyZWxhdGlvbk5hbWVzJyBhbmQgJ3Jlc291cmNlVHlwZSdcclxuICogaW5mb3JtYXRpb24gYWJvdXQgdGhpcyByZXNvdXJjZS5cclxuICpcclxuICogQHBhcmFtIHJlbGF0aW9uTmFtZXMgbmFtZXMgb2YgdGhlIHByb3BlcnRpZXMgdGhhdCB1c2luZyB0byBob2xkIHRoaXMgZW1iZWRkZWQgcmVzb3VyY2UgaW4gcmVzb3VyY2Ugb2JqZWN0cy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBIYXRlb2FzRW1iZWRkZWRSZXNvdXJjZShyZWxhdGlvbk5hbWVzOiBBcnJheTxzdHJpbmc+KSB7XHJcbiAgcmV0dXJuIDxUIGV4dGVuZHMgbmV3KC4uLmFyZ3M6IGFueVtdKSA9PiBhbnk+KGNvbnN0cnVjdG9yOiBUKSA9PiB7XHJcbiAgICBpZiAoaXNOdWxsKHJlbGF0aW9uTmFtZXMpXHJcbiAgICAgIHx8IGlzVW5kZWZpbmVkKHJlbGF0aW9uTmFtZXMpXHJcbiAgICAgIHx8IChpc0FycmF5KHJlbGF0aW9uTmFtZXMpICYmIGlzRW1wdHkocmVsYXRpb25OYW1lcykpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSAnJHsgY29uc3RydWN0b3IubmFtZSB9JyBlcnJvci4gQEhhdGVvYXNFbWJlZGRlZFJlc291cmNlIGRlY29yYXRvciBwYXJhbSByZWxhdGlvbk5hbWVzIGNhbiBub3QgYmUgbnVsbC91bmRlZmluZWQvZW1wdHksIHBsZWFzZSBwYXNzIGEgdmFsaWQgcmVsYXRpb25OYW1lcy5gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWlzSW5zdGFuY2VPZlBhcmVudChjb25zdHJ1Y3RvciwgRW1iZWRkZWRSZXNvdXJjZSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc0VtYmVkZGVkUmVzb3VyY2UgZGVjb3JhdG9yIGFwcGxpZWQgb25seSB0byAnRW1iZWRkZWRSZXNvdXJjZScgdHlwZSwgeW91IHVzZWQgaXQgd2l0aCAkeyBPYmplY3QuZ2V0UHJvdG90eXBlT2YoY29uc3RydWN0b3IpIH0gdHlwZS5gKTtcclxuICAgIH1cclxuICAgIHJlbGF0aW9uTmFtZXMuZm9yRWFjaChyZWxhdGlvbk5hbWUgPT4ge1xyXG4gICAgICBSZXNvdXJjZVV0aWxzLkVNQkVEREVEX1JFU09VUkNFX1RZUEVfTUFQLnNldChyZWxhdGlvbk5hbWUsIGNvbnN0cnVjdG9yKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBjcmVhdGUgYSBwcm9qZWN0aW9uIHJlcHJlc2VudGF0aW9uIG9mIHtAbGluayBSZXNvdXJjZX0gaGVpcnMuXHJcbiAqXHJcbiAqIEBwYXJhbSByZXNvdXJjZVR5cGUgdHlwZSBvZiByZXNvdXJjZSB0aGF0IHVzaW5nIGZvciBwcm9qZWN0aW9uLlxyXG4gKiBAcGFyYW0gcHJvamVjdGlvbk5hbWUgbmFtZSBvZiBwcm9qZWN0aW9uLCB3aWxsIGJlIHVzZWQgYXMgcHJvamVjdGlvbiByZXF1ZXN0IHBhcmFtLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIEhhdGVvYXNQcm9qZWN0aW9uKHJlc291cmNlVHlwZTogbmV3KCkgPT4gUmVzb3VyY2UsIHByb2plY3Rpb25OYW1lOiBzdHJpbmcpIHtcclxuICByZXR1cm4gPFQgZXh0ZW5kcyBuZXcoLi4uYXJnczogYW55W10pID0+IGFueT4oY29uc3RydWN0b3I6IFQpID0+IHtcclxuICAgIGlmIChpc051bGwocmVzb3VyY2VUeXBlKSB8fCBpc1VuZGVmaW5lZChyZXNvdXJjZVR5cGUpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSBwcm9qZWN0aW9uICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc1Byb2plY3Rpb24gZGVjb3JhdG9yIHBhcmFtIHJlc291cmNlVHlwZSBjYW4gbm90IGJlIG51bGwvdW5kZWZpbmVkLCBwbGVhc2UgcGFzcyBhIHZhbGlkIHJlc291cmNlVHlwZS5gKTtcclxuICAgIH1cclxuICAgIGlmIChpc051bGwocHJvamVjdGlvbk5hbWUpIHx8IGlzVW5kZWZpbmVkKHByb2plY3Rpb25OYW1lKSB8fCAhcHJvamVjdGlvbk5hbWUpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbml0IHJlc291cmNlIHByb2plY3Rpb24gJyR7IGNvbnN0cnVjdG9yLm5hbWUgfScgZXJyb3IuIEBIYXRlb2FzUHJvamVjdGlvbiBkZWNvcmF0b3IgcGFyYW0gcHJvamVjdGlvbk5hbWUgY2FuIG5vdCBiZSBudWxsL3VuZGVmaW5lZC9lbXB0eSwgcGxlYXNlIHBhc3MgYSB2YWxpZCBwcm9qZWN0aW9uTmFtZS5gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWlzSW5zdGFuY2VPZlBhcmVudChjb25zdHJ1Y3RvciwgUmVzb3VyY2UpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW5pdCByZXNvdXJjZSBwcm9qZWN0aW9uICckeyBjb25zdHJ1Y3Rvci5uYW1lIH0nIGVycm9yLiBASGF0ZW9hc1Byb2plY3Rpb24gZGVjb3JhdG9yIGFwcGxpZWQgb25seSB0byAnUmVzb3VyY2UnIHR5cGUsIHlvdSB1c2VkIGl0IHdpdGggJHsgT2JqZWN0LmdldFByb3RvdHlwZU9mKGNvbnN0cnVjdG9yKSB9IHR5cGUuYCk7XHJcbiAgICB9XHJcbiAgICBjb25zdHJ1Y3RvclsnX19yZXNvdXJjZU5hbWVfXyddID0gcmVzb3VyY2VUeXBlWydfX3Jlc291cmNlTmFtZV9fJ107XHJcbiAgICBjb25zdHJ1Y3RvclsnX19wcm9qZWN0aW9uTmFtZV9fJ10gPSBwcm9qZWN0aW9uTmFtZTtcclxuICAgIFJlc291cmNlVXRpbHMuUkVTT1VSQ0VfTkFNRV9QUk9KRUNUSU9OX1RZUEVfTUFQLnNldChyZXNvdXJjZVR5cGVbJ19fcmVzb3VyY2VOYW1lX18nXS50b0xvd2VyQ2FzZSgpLCBjb25zdHJ1Y3Rvcik7XHJcblxyXG4gICAgcmV0dXJuIGNvbnN0cnVjdG9yO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWNvcmF0b3IgdXNlZCB0byBtYXJrIHByb2plY3Rpb24gY2xhc3MgcHJvcGVydGllcyB0aGF0IGFyZSByZXNvdXJjZXMgYW5kIHNwZWNpZnlpbmcgY2xhc3MgdHlwZSB1c2VkIHRvIGNyZWF0ZSB0aGlzIHJlbGF0aW9uLlxyXG4gKiBUaGlzIGRlY29yYXRvciB1c2VkIHdpdGggY2xhc3MgbWFya2VkIGFzIHtAbGluayBIYXRlb2FzUHJvamVjdGlvbn0uXHJcbiAqXHJcbiAqIEBwYXJhbSByZWxhdGlvblR5cGUgcmVzb3VyY2UgcmVsYXRpb24gdHlwZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgcmVzb3VyY2Ugd2l0aCB0aGlzIHR5cGUgd2hlbiBwYXJzZWQgc2VydmVyIHJlc3BvbnNlLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIFByb2plY3Rpb25SZWwocmVsYXRpb25UeXBlOiBuZXcoKSA9PiBCYXNlUmVzb3VyY2UpIHtcclxuICByZXR1cm4gKHRhcmdldDogb2JqZWN0LCBwcm9wZXJ0eUtleTogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoaXNOdWxsKHJlbGF0aW9uVHlwZSkgfHwgaXNVbmRlZmluZWQocmVsYXRpb25UeXBlKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEluaXQgcmVzb3VyY2UgcHJvamVjdGlvbiAnJHsgdGFyZ2V0LmNvbnN0cnVjdG9yLm5hbWUgfScgcmVsYXRpb24gdHlwZSBlcnJvci4gQFByb2plY3Rpb25SZWwgZGVjb3JhdG9yIHBhcmFtIHJlbGF0aW9uVHlwZSBjYW4gbm90IGJlIG51bGwvdW5kZWZpbmVkLCBwbGVhc2UgcGFzcyBhIHZhbGlkIHJlbGF0aW9uVHlwZS5gKTtcclxuICAgIH1cclxuXHJcbiAgICBSZXNvdXJjZVV0aWxzLlJFU09VUkNFX1BST0pFQ1RJT05fUkVMX05BTUVfVFlQRV9NQVAuc2V0KHByb3BlcnR5S2V5LCByZWxhdGlvblR5cGUpO1xyXG4gIH07XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBpc0luc3RhbmNlT2ZQYXJlbnQoY29uc3RydWN0b3I6IG5ldyAoLi4uYXJnczogYW55W10pID0+IGFueSwgcGFyZW50Q2xhc3M6IGFueSkge1xyXG4gIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YoY29uc3RydWN0b3IpLm5hbWUgPT09ICcnKSB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YoY29uc3RydWN0b3IpID09PSBwYXJlbnRDbGFzcykge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaXNJbnN0YW5jZU9mUGFyZW50KE9iamVjdC5nZXRQcm90b3R5cGVPZihjb25zdHJ1Y3RvciksIHBhcmVudENsYXNzKTtcclxufVxyXG4iXX0=